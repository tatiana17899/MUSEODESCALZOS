@using MUSEO_DE_LOS_DESCALZOS.ViewModel
@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.1.6/css/dataTables.dataTables.min.css"
    />
<div class="content flex-grow-1" id="contenido">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">@ViewData["Title"]</h1>
    </div>
    <div class="row mb-4">
        <!-- Tarjetas de estadísticas -->
        <div class="col-md-4 mb-3">
            <div class="card shadow">
                <div class="card-body d-flex align-items-center">
                    <div class="display-4 me-3">@Model.CantidadAlquileres</div>
                    <div>
                        <div class="text-muted">Cantidad de Ventas - Alquileres</div>
                        <i class="fa-solid fa-truck-ramp-box"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow">
                <div class="card-body d-flex align-items-center">
                    <div class="display-4 me-3">@Model.CantidadVisitas</div>
                    <div>
                        <div class="text-muted">Cantidad de Ventas - Visitas</div>
                        <i class="fas fa-map-marker-alt text-muted icon"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow">
                <div class="card-body d-flex align-items-center">
                    <div class="display-4 me-3">@Model.CantidadEventos</div>
                    <div>
                        <div class="text-muted">Cantidad de Ventas - Eventos</div>
                        <i class="fas fa-calendar-alt text-muted icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <!-- Gráficos y análisis -->
        <div class="col-md-6 mb-3">
            <div class="card shadow">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <h5 class="card-title me-3">Análisis gráfico de las ventas</h5>
                        <div class="input-group">
                            <input type="text" class="form-control" id="fecha-seleccionada" placeholder="Seleccionar fecha" />
                            <label for="fecha-seleccionada" class="input-group-text">
                                <i class="fas fa-calendar-alt"></i>
                            </label>
                        </div>
                    </div>
                    <img src="https://placehold.co/400x200" alt="Graph showing sales analysis" class="img-fluid" />
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title">Ventas de categorías</h5>
                    <img src="https://placehold.co/200x200" alt="Pie chart showing sales categories" class="img-fluid" />
                    <div class="mt-3">
                        <div class="d-flex align-items-center mb-2">
                            <div class="bg-danger rounded-circle me-2" style="width: 16px; height: 16px"></div>
                            Visitas
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="bg-warning rounded-circle me-2" style="width: 16px; height: 16px"></div>
                            Eventos
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h5 class="card-title d-flex align-items-center">
              <i class="fas fa-history me-2"></i>Historial de Ventas
            </h5>
            <div class="card-body">
                <form asp-controller="Dashboard" asp-action="Mostrar" method="post">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label" asp-for="FormAdmin.FechaInicio">Fecha de Inicio</label>
                            <input type="date" class="form-control" id="fechaInicio" asp-for="FormAdmin.FechaInicio" value="@string.Format("{0:yyyy-MM-dd}", Model.FormAdmin.FechaInicio)" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label" asp-for="FormAdmin.FechaFin">Fecha de Fin</label>
                            <input type="date" class="form-control" id="fechaFin" asp-for="FormAdmin.FechaFin" value="@string.Format("{0:yyyy-MM-dd}", Model.FormAdmin.FechaFin)" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label" asp-for="FormAdmin.TipVenta">Tipo de Venta</label>
                            <select class="form-select" id="tipoVenta" asp-for="FormAdmin.TipVenta">
                                <option value="">Seleccione...</option>
                                <option value="alquileres" selected="@(Model.FormAdmin.TipVenta == "alquileres")">Alquileres</option>
                                <option value="visitas" selected="@(Model.FormAdmin.TipVenta == "visitas")">Visitas</option>
                                <option value="eventos" selected="@(Model.FormAdmin.TipVenta == "eventos")">Eventos</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary me-2">Buscar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <table id="ventasTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Monto</th>
                    @if (Model.FormAdmin.TipVenta == "alquileres")
                    {
                        <th>Cliente</th>
                        <th>Alquiler</th>
                        <th>Hora Inicio</th>
                        <th>Hora Fin</th>
                        <th>Cantidad Personas</th>
                    }
                    @if (Model.FormAdmin.TipVenta == "visitas")
                    {
                        <th>Cliente</th>
                        <th>Detalle</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Guía</th>
                    }
                    @if (Model.FormAdmin.TipVenta == "eventos")
                    {
                        <th>Cliente</th>
                        <th>Evento</th>
                        <th>Detalle</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var venta in Model.ListVenta)
                {
                    <tr>
                        <td>@venta.Id</td>
                        <td>@venta.Fecha.ToShortDateString()</td>
                        <td>@venta.Tipo</td>
                        <td>@venta.Monto.ToString("C")</td>

                        @if (venta is AlquilerViewModel alquiler)
                        {
                            <td>@alquiler.Cliente.Nombres</td>
                            <td>@alquiler.Alquiler</td>
                            <td>@alquiler.HoraInicio.ToShortTimeString()</td>
                            <td>@alquiler.HoraFin.ToShortTimeString()</td>
                            <td>@alquiler.CantPersona</td>
                        }
                        else if (venta is VisitaViewModel visita)
                        {
                            <td>@visita.Cliente.Nombres</td>
                            <td>@visita.Detalle</td>
                            <td>@visita.Cantidad</td>
                            <td>@visita.PrecioUnitario.ToString("C")</td>
                            <td>@visita.Guía.Nombres</td>
                        }
                        else if (venta is EventoViewModel evento)
                        {
                            <td>@evento.Cliente.Nombres</td>
                            <td>@evento.Evento</td>
                            <td>@evento.Detalle</td>
                            <td>@evento.Cantidad</td>
                            <td>@evento.PrecioUnitario.ToString("C")</td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>
@section scripts{
<!-- Incluye los scripts de jQuery, DataTables y Pikaday -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- DataTables -->
<script src="https://cdn.datatables.net/2.1.5/js/dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>

<script>
    $(document).ready(function() {
        $('#ventasTable').DataTable();
    });
</script>

}